<section>
    <md-tabs md-dynamic-height md-border-bottom class="md-primary">
        <md-tab ng-repeat="world in guildsOverviewCtrl.worlds">
            <md-tab-label>
                {{ world.name }}
            </md-tab-label>
            <md-tab-body>
                <section layout-padding>
                    <div layout="row">
                        <h2 class="md-headline" flex>
                            Guilds overview of {{ world.name }}
                        </h2>
                        <md-button class="md-raised md-accent md-fab" ng-click="guildsOverviewCtrl.newGuildDialog($event, world)">
                            <md-icon md-svg-icon="guild_light"></md-icon>
                            <md-tooltip md-direction="left">
                                Create new guild for "{{ world.name }}"
                            </md-tooltip>
                        </md-button>
                    </div>
                    <div layout="row" layout-wrap>
                        <h3 ng-if="world.guilds.length < 1" class="md-title">
                            No guilds have come to conquer {{ world.name }}.
                        </h3>
                        <div flex="100"
                            flex-gt-xs="50"
                            flex-gt-sm="100"
                            flex-gt-md="50"
                            flex-lg="33"
                            flex-gt-lg="25"
                            ng-repeat="guild in world.guilds | orderBy: '-created_at'">

                            <md-card>
                                <section layout-padding layout-align="end center" layout>
                                    <md-card-title>
                                        <md-card-title-text layout="row">
                                            <span class="md-headline" flex layout-margin>
                                                {{guild.name}}
                                            </span>
                                        </md-card-title-text>
                                    </md-card-title>
                                    <md-menu>
                                        <md-button aria-label="Open menu" class="md-icon-button" ng-click="$mdOpenMenu($event)">
                                            <md-icon md-menu-origin md-svg-icon="more_vert_dark"></md-icon>
                                        </md-button>
                                        <md-menu-content width="4" >
                                            <md-menu-item aria-label="View {{ guild.name }}" ui-sref="base.guilds.detail({guildUuid: guild.id})">
                                                <md-button>
                                                    <div layout="row">
                                                        <md-icon
                                                            md-menu-align-target
                                                            md-svg-icon="eye_dark">
                                                        </md-icon>
                                                        <p flex>
                                                            View
                                                        </p>
                                                    </div>
                                                </md-button>
                                            </md-menu-item>
                                            <md-menu-item aria-label="Change guild settings" ui-sref="base.guilds.settings({guildUuid: guild.id})">
                                                <md-button>
                                                    <div layout="row">
                                                        <md-icon
                                                            md-menu-align-target
                                                            md-svg-icon="settings_dark">
                                                        </md-icon>
                                                        <p flex>
                                                            Settings
                                                        </p>
                                                    </div>
                                                </md-button>
                                            </md-menu-item>
                                            <md-menu-item ng-click="guildsOverviewCtrl.addGuildMember($event, world, guild)">
                                                <md-button>
                                                    <div layout="row">
                                                        <md-icon
                                                            md-menu-align-target
                                                            md-svg-icon="add_dark">
                                                        </md-icon>
                                                        <p flex>
                                                            Add guild member
                                                        </p>
                                                    </div>
                                                </md-button>
                                            </md-menu-item>
                                        </md-menu-content>
                                    </md-menu>
                                </section>

                                <md-divider></md-divider>

                                <md-card-content>
                                    <md-list dnd-list="guild.members"
                                        dnd-inserted="guildsOverviewCtrl.movePlayer(event, guild, item)">
                                        <md-list-item ng-repeat="player in guild.members"
                                            dnd-draggable="player"
                                            dnd-moved="guild.members.splice($index, 1)"
                                            dnd-effect-allowed="move">
                                            <img class="round" gravatar-size="45" gravatar-src="player.email" layout-padding>
                                            <span flex>
                                                {{ player.first_name }} {{ player.surname }}
                                            </span>
                                            <md-icon md-svg-icon="delete_dark" ng-click="guildsOverviewCtrl.removeGuildMember(player, guild)">
                                                <md-tooltip md-direction="bottom">
                                                    Remove player from guild
                                                </md-tooltip>
                                            </md-icon>
                                        </md-list-item>
                                    </md-list>
                                </md-card-content>
                            </md-card>

                        </div> <!-- End of guilds -->

                    </div>


                </section>
            </md-tab-body>
        </md-tab>
    </md-tabs>
</section>
