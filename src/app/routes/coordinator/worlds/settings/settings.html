<section flex layout="column">
    <md-toolbar>
        <div class="md-toolbar-tools" layout>
            <md-button class="md-icon-button" ui-sref="base.worlds.overview">
                <md-icon md-svg-src="back_light"></md-icon>
                <md-tooltip md-direction="top" md-delay="1000">
                    Take me back
                </md-tooltip>
            </md-button>
            <span flex>
                Class settings of: {{ worldsSettingsCtrl.world.name }}
            </span>
        </div>
    </md-toolbar>
    <section flex layout layout-fill>
        <section flex=80 layout="column">
            <section flex ng-if="worldsSettingsCtrl.loading_page" layout-fill layout="column" layout-align="center center">
                <span>
                    <md-progress-circular md-mode="indeterminate"></md-progress-circular>
                </span>
                <span>
                    loading page
                </span>
            </section>
            <section flex ng-if="!worldsSettingsCtrl.loading_page" layout-fill layout="column">
                <section flex=50 ng-if="worldsSettingsCtrl.world.quests.length < 1" layout="column" layout-align="center center">
                    <span>
                        <md-icon class="icon--size--192 icon--color--grey" md-svg-icon="book_dark">
                        </md-icon>
                    </span>
                    <span class="md-headline">
                        No assessments in this class.
                    </span>
                    <span class="md-title text--color--blueGrey">
                        Add a new assessments to your right.
                    </span>
                </section>
                <section layout-margin flex=50 ng-if="worldsSettingsCtrl.world.quests.length >= 1">
                    <md-content layout="column" md-whiteframe=1 >
                        <md-toolbar>
                            <div class="md-toolbar-tools">
                                <span flex=30> Assessment </span>
                                <span flex=20> Group power </span>
                                <span flex=30> Completion </span>
                                <span flex=10 layout layout-align="center center">
                                    Active
                                </span>
                                <span flex=10> <!-- placeholder --> </span>
                            </div>
                        </md-toolbar>
                        <md-list>
                            <md-list-item ng-repeat="quest in worldsSettingsCtrl.world.quests | orderBy : 'created_at'">
                                <span flex=30> {{ quest.name }} </span>
                                <span flex=20> {{ quest.experience | number }} </span>
                                <span flex=30 layout-padding>
                                    <div ng-if="!quest.total_guilds_conquering_quest"
                                    class="text--color--grey">
                                        No groups have seen this quest yet.
                                    </div>
                                    <div ng-if="quest.total_guilds_conquering_quest">
                                        <section layout="row" layout-align="space-between">
                                            <span>0</span>
                                            <span>{{ quest.total_guilds_conquering_quest }}</span>
                                        </section>
                                        <md-progress-linear md-mode="determinate"
                                        ng-class="{
                                            'md-warn': quest.completion_percentage <= 20,
                                            'md-accent': quest.completion_percentage > 40 &&
                                            quest.completion_percentage <=70,
                                        }"
                                        value="{{quest.completion_percentage}}">
                                        </md-progress-linear>
                                        <md-tooltip>
                                            <strong>
                                                {{ quest.total_guilds_finished_quest }}
                                            </strong>
                                            out of
                                            <strong>
                                                {{ quest.total_guilds_conquering_quest }}
                                            </strong>
                                            group(s) completed this assessment
                                        </md-tooltip>
                                    </div>
                                </span>
                                <span flex=10 layout="row" layout-align="center center">
                                    <div ng-repeat="v in [0]">
                                        <md-switch class="md-primary"
                                        ng-change="worldsSettingsCtrl.toggleQuest(quest)"
                                        md-no-ink
                                        aria-label="Toggle quest"
                                        ng-model="quest.active">
                                        </md-switch>
                                    </div>
                                </span>
                                <span flex=10 layout="row" layout-align="end">
                                    <md-button class="md-icon-button"
                                     ui-sref="base.worlds.quests.edit({questUuid: quest.id, worldUuid: worldsSettingsCtrl.world.id })">
                                        <md-icon md-svg-icon="pencil_dark"></md-icon>
                                        <md-tooltip md-delay="1000"> Edit </md-tooltip>
                                    </md-button>
                                    <md-button class="md-icon-button"
                                     ng-click="worldsSettingsCtrl.deleteQuest($event, quest)">
                                        <md-icon md-svg-icon="delete_dark"></md-icon>
                                        <md-tooltip md-delay="1000"> Delete </md-tooltip>
                                    </md-button>
                                </span>
                            </md-list-item>
                        </md-list>
                    </md-content>
                </section>
                <md-divider></md-divider>
                <section flex=50 ng-if="worldsSettingsCtrl.world.rules.length < 1"
                layout="column" layout-align="center center">
                    <span>
                        <md-icon class="icon--size--192 icon--color--grey" md-svg-icon="rules_dark">
                        </md-icon>
                    </span>
                    <span class="md-headline">
                        Dobby has no master!
                    </span>
                    <span class="md-title text--color--blueGrey">
                        Dobby is a free elf...
                    </span>
                    <span class="md-subtitle text--color--grey">
                        ...Or add some rules on the right.
                    </span>
                </section>
            </section>
        </section>

        <md-content flex=20 layout="column" style="overflow-x: hidden;">
            <section>
                <md-subheader>
                    Actions
                </md-subheader>
                <section layout="column">
                    <md-button class="md-raised md-accent"
                    ng-click="worldsSettingsCtrl.changeWorldName($event)" layout>
                        <md-icon md-svg-src="pencil_light"></md-icon>
                        <span flex>
                            Change class name
                        </span>
                    </md-button>
                    <md-button class="md-raised success"
                    ui-sref="base.worlds.quests.new({worldUuid: worldsSettingsCtrl.world.id})" layout>
                        <md-icon md-svg-src="book_light"></md-icon>
                        <span flex>
                            New assessment
                        </span>
                    </md-button>
                    <md-button class="md-raised success" layout>
                        <md-icon md-svg-src="rules_light"></md-icon>
                        <span flex>
                            New rule
                        </span>
                    </md-button>
                    <md-button class="md-warn md-raised"
                    ng-click="worldsSettingsCtrl.deleteWorld($event)" layout>
                        <md-icon md-svg-src="delete_light"></md-icon>
                        <span flex>
                            Delete class
                        </span>
                    </md-button>
                </section>
            </section>

            <section>
                <md-subheader>
                    Lecturers ({{worldsSettingsCtrl.world.gamemasters.length}})
                </md-subheader>
                <section layout layout-wrap>
                    <span flex=33 layout layout-padding layout-align="center"
                        ng-repeat="gamemaster in worldsSettingsCtrl.world.gamemasters">
                        <img class="round" gravatar-size="60" gravatar-src-once="gamemaster.email">
                        <md-tooltip md-delay="1000">
                            {{ gamemaster | fullUserName }}
                        </md-tooltip>
                    </span>
                </section>
            </section>

            <section>
                <md-subheader>
                    Groups ({{worldsSettingsCtrl.world.guilds.length}})
                </md-subheader>
                <section>
                    <md-list>
                        <md-list-item ng-repeat="guild in worldsSettingsCtrl.world.guilds"
                        ui-sref="base.guilds.detail({guildUuid: guild.id})">
                            {{ guild.name }}
                            <md-tooltip md-delay="1000">
                                View {{ guild.name }}
                            </md-tooltip>
                        </md-list-item>
                    </md-list>
                </section>
            </section>
        </md-content>
    </section>
</section>
