<section flex layout="column">
    <section flex layout>
        <section flex=80 layout="column" layout-padding>
            <cmd-loading-page ng-if="worldsSettingsCtrl.loading_page"></cmd-loading-page>
            <section flex ng-if="!worldsSettingsCtrl.loading_page" layout-fill layout-margin layout="column">
                <cmd-empty-state flex ng-if="worldsSettingsCtrl.world.quests.length < 1"
                    icon="book_dark"
                    headline="No assessments in this class."
                    title="Add a new assessments to your right.">
                </cmd-empty-state>
                <section flex ng-if="worldsSettingsCtrl.world.quests.length >= 1">
                    <md-content flex="100" md-whiteframe=1 layout="column">
                        <md-toolbar>
                            <div class="md-toolbar-tools">
                                <span flex=10 layout layout-align="center center">
                                    Active
                                </span>
                                <span flex=25> Assessment </span>
                                <span flex=30> Completion </span>
                                <span flex=10 layout layout-align="center center">
                                    Gradable
                                </span>
                                <span flex=15> Power </span>
                                <span flex=10> <!-- placeholder --> </span>
                            </div>
                        </md-toolbar>
                        <div layout="row" flex>
                            <md-content ng-scrollbars flex>
                                <md-list>
                                    <md-list-item ng-repeat="quest in worldsSettingsCtrl.world.quests | orderBy : 'completion_percentage'">
                                        <span flex=10 layout="row" layout-align="center center">
                                            <div ng-repeat="v in [0]">
                                                <md-switch class="md-primary"
                                                ng-change="worldsSettingsCtrl.patchQuest(quest)"
                                                md-no-ink
                                                aria-label="Toggle quest gradable"
                                                ng-model="quest.active">
                                                </md-switch>
                                            </div>
                                        </span>
                                        <span flex=25> {{ quest.name }} </span>
                                        <span flex=30 layout-padding>
                                            <div ng-if="!quest.total_guilds_conquering_quest"
                                            class="text--color--grey">
                                                No groups have seen this quest yet.
                                            </div>
                                            <div ng-if="quest.total_guilds_conquering_quest">
                                                <section layout="row" layout-align="space-between">
                                                    <span>0</span>
                                                    <span>{{ quest.total_guilds_conquering_quest }}</span>
                                                </section>
                                                <md-progress-linear md-mode="determinate"
                                                ng-class="{
                                                    'md-warn': quest.completion_percentage <= 20,
                                                    'md-accent': quest.completion_percentage > 40 &&
                                                    quest.completion_percentage <=70,
                                                }"
                                                value="{{quest.completion_percentage}}">
                                                </md-progress-linear>
                                                <md-tooltip>
                                                    <strong>
                                                        {{ quest.total_guilds_finished_quest }}
                                                    </strong>
                                                    out of
                                                    <strong>
                                                        {{ quest.total_guilds_conquering_quest }}
                                                    </strong>
                                                    group(s) completed this assessment
                                                </md-tooltip>
                                            </div>
                                        </span>
                                        <span flex=10 layout="row" layout-align="center center">
                                            <div ng-repeat="v in [0]">
                                                <md-switch class="md-primary"
                                                ng-change="worldsSettingsCtrl.patchQuest(quest)"
                                                md-no-ink
                                                aria-label="Toggle quest status"
                                                ng-model="quest.gradable">
                                                </md-switch>
                                            </div>
                                        </span>
                                        <span flex=15>
                                            <span ng-if="quest.gradable">
                                                {{ quest.experience | number }}
                                            </span>
                                            <span class="text--color--grey"
                                            ng-if="!quest.gradable">
                                                Not gradable
                                            </span>
                                        </span>
                                        <span flex=10 layout="row" layout-align="end">
                                            <md-button class="md-icon-button"
                                             ui-sref="base.worlds.quests.edit({questUuid: quest.id, worldUuid: worldsSettingsCtrl.world.id })">
                                                <md-icon md-svg-icon="pencil_dark"></md-icon>
                                                <md-tooltip md-delay="1000"> Edit </md-tooltip>
                                            </md-button>
                                            <md-button class="md-icon-button"
                                             ng-click="worldsSettingsCtrl.deleteQuest($event, quest)">
                                                <md-icon md-svg-icon="delete_dark"></md-icon>
                                                <md-tooltip md-delay="1000"> Delete </md-tooltip>
                                            </md-button>
                                        </span>
                                    </md-list-item>
                                </md-list>
                            </md-content>
                        </div>
                    </md-content>
                </section>
            </section>
        </section>

        <md-content flex=20 layout="column" style="overflow-x: hidden;">
            <section>
                <md-subheader>
                    Actions
                </md-subheader>
                <section layout="column">
                    <md-button class="md-raised md-accent"
                    ng-click="worldsSettingsCtrl.changeWorldName($event)" layout>
                        <md-icon md-svg-src="pencil_light"></md-icon>
                        <span flex>
                            Change class name
                        </span>
                    </md-button>
                    <md-button class="md-raised success"
                    ui-sref="base.worlds.quests.new({worldUuid: worldsSettingsCtrl.world.id})" layout>
                        <md-icon md-svg-src="book_light"></md-icon>
                        <span flex>
                            New assessment
                        </span>
                    </md-button>
                    <md-button class="md-warn md-raised"
                    ng-click="worldsSettingsCtrl.deleteWorld($event)" layout>
                        <md-icon md-svg-src="delete_light"></md-icon>
                        <span flex>
                            Delete class
                        </span>
                    </md-button>
                </section>
            </section>

            <section>
                <md-subheader>
                    Lecturers ({{worldsSettingsCtrl.world.gamemasters.length}})
                </md-subheader>
                <section layout layout-wrap>
                    <span flex=33 layout layout-padding layout-align="center"
                        ng-repeat="gamemaster in worldsSettingsCtrl.world.gamemasters">
                        <img class="round" gravatar-size="60" gravatar-src-once="gamemaster.email">
                        <md-tooltip md-delay="1000">
                            {{ gamemaster | fullUserName }}
                        </md-tooltip>
                    </span>
                </section>
            </section>

            <section>
                <md-subheader>
                    Groups ({{worldsSettingsCtrl.world.guilds.length}})
                </md-subheader>
                <section>
                    <md-list>
                        <md-list-item ng-repeat="guild in worldsSettingsCtrl.world.guilds"
                        ui-sref="base.guilds.detail({guildUuid: guild.id})">
                            {{ guild.name }}
                            <md-tooltip md-delay="1000">
                                View {{ guild.name }}
                            </md-tooltip>
                            <md-divider ng-if="!$last"></md-divider>
                        </md-list-item>
                    </md-list>
                </section>
            </section>
        </md-content>
    </section>
</section>
