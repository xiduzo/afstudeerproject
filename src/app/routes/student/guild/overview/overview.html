<section flex layout="column">

    <cmd-loading-page ng-if="guildOverviewCtrl.loading_page"></cmd-loading-page>

    <cmd-empty-state ng-if="guildOverviewCtrl.guilds.length < 1 && !guildsOverviewCtrl.loading_page"
    icon="guild_dark"
    headline="No group found."
    title="Wait for a lecturer to add you to a class.">
    </cmd-empty-state>

    <section layout-fill ng-if="guildOverviewCtrl.guilds.length >= 1 && !guildsOverviewCtrl.loading_page">
        <section flex layout="column" layout-fill
        ng-repeat="guild in guildOverviewCtrl.guilds"
        ng-if="guild.id === guildOverviewCtrl.selected_guild">
            <section layout="column" flex layout-align="start stretch">
                <md-toolbar>
                    <span class="md-toolbar-tools">
                        {{ guild.name }}
                    </span>
                </md-toolbar>
                <onboarding-popover
                enabled="guildOverviewCtrl.onboarding_enabled"
                steps="guildOverviewCtrl.onboarding_steps"
                on-finish-callback='guildOverviewCtrl.callback'
                step-index='guildOverviewCtrl.onboarding_step_index'>
                </onboarding-popover>
                <onboarding-popover ng-if="guildOverviewCtrl.onboarding_steps_2_enabled"
                enabled="guildOverviewCtrl.onboarding_steps_2_enabled"
                steps="guildOverviewCtrl.onboarding_steps_2"
                on-finish-callback='guildOverviewCtrl.steps_2_callback'
                step-index='guildOverviewCtrl.onboarding_steps_2_index'>
                </onboarding-popover>
                <section id="step3">
                    <md-button class="md-fab icon__fab"
                        ng-click="guildOverviewCtrl.addObjective($event, guild)">
                        <md-icon md-svg-icon="add_light"></md-icon>
                        <md-tooltip md-direction="left">
                            Add task
                        </md-tooltip>
                    </md-button>
                </section>
                <section flex=40 layout="row" layout-margin>
                    <md-content flex=100 flex-gt-sm="60" layout="row" md-whiteframe=1 id="step1">
                        <cmd-empty-state ng-if="guild.no_graph_data"
                        icon="timeline_dark"
                        headline="No data found."
                        title="Add an task to view your groups' progress.">
                        </cmd-empty-state>
                        <div id="{{guild.id}}" flex="100" ng-if="!guild.no_graph_data"
                            layout="row" layout-align="center center">
                            <span ng-if="!guild.graph_data_loaded">
                                Loading data
                            </span>
                        </div>
                    </md-content>
                    <md-content md-whiteframe=1 flex="40"
                        layout="column" layout-align="space-between stretch">
                        <md-toolbar>
                            <h1 class="md-toolbar-tools">
                                Latest news
                            </h1>
                        </md-toolbar>
                        <div layout="row" flex>
                            <cmd-empty-state ng-if="guild.history_updates.length < 1"
                            headline="No group news."
                            title="Group news will appear over here."
                            subtitle="Try adding and task">
                            </cmd-empty-state>
                            <md-content ng-scrollbars flex ng-if="guild.history_updates.length >= 1">
                                <md-list>
                                    </md-list-item>
                                    <md-list-item ng-repeat="update in guild.history_updates | orderBy: '-created_at'">
                                        <span flex=80 layout-padding>
                                            {{ update.user | fullUserName }} {{ update.action }}
                                        </span>
                                        <span>
                                            {{ update.created_at | fromNow }}
                                        </span>
                                    </md-list-item>
                                </md-list>
                            </md-content>
                        </div>
                    </md-content>
                </section>
                <section flex=60 layout="row" layout-margin>
                    <md-content flex="100" md-whiteframe=1 layout="column" id="step2">
                        <md-toolbar ng-if="guild.objectives.length >= 1">
                            <div layout="row" class="md-toolbar-tools">
                                <span flex="10" layout="row" layout-align="center">
                                    Completed
                                </span>
                                <span flex="20">
                                    Name
                                </span>
                                <span flex="40" layout-padding>
                                    Task
                                </span>
                                <span flex="15" layout-padding>
                                    Assigned to
                                </span>
                                <span flex="5">
                                    Points
                                </span>
                                <span flex="10">
                                    <!-- placeholder -->
                                </span>
                            </div>
                        </md-toolbar>
                        <div layout="row" flex id="step4">
                            <cmd-empty-state ng-if="guild.objectives.length < 1"
                            icon="list_dark"
                            headline="No tasks found."
                            title="Add tasks so your group knows what to do.">
                            </cmd-empty-state>
                            <md-content ng-scrollbars flex ng-if="guild.objectives.length >= 1">
                                <md-list>
                                    <div ng-repeat="objective in guild.objectives | orderBy: ['completed', '-completed_at', '-created_at']">
                                        <md-list-item>
                                            <!-- https://github.com/angular/material/issues/2819#issuecomment-136321546 -->
                                            <span flex="10" ng-repeat="v in [0]"
                                                layout="row" layout-align="center">
                                                <md-checkbox style="margin-bottom: 0;" ng-model="objective.completed"
                                                    aria-label="Toggle status"
                                                    ng-click="guildOverviewCtrl.updateStatus(guild, objective)">
                                                </md-checkbox>
                                            </span>
                                            <span flex="20">
                                                {{ objective.name }}
                                            </span>
                                            <span flex="40" layout-padding>
                                                {{ objective.objective }}
                                            </span>
                                            <span flex="15" layout="row" layout-wrap layout-padding>
                                                <span ng-if="objective.assignments.length < 1">
                                                    -
                                                </span>
                                                <span flex=33 ng-repeat="assignment in objective.assignments"
                                                    ng-click="guildOverviewCtrl.removeObjectiveAssignment(guild, objective, assignment, $index)">
                                                    <img class="round" gravatar-size="40" gravatar-src-once="assignment.user.email">
                                                    <md-tooltip md-delay="1000" md-direction="top">
                                                        Remove {{ assignment.user | fullUserName}}
                                                    </md-tooltip>
                                                </span>
                                            </span>
                                            <span flex="5">
                                                {{ objective.points | number  }}
                                            </span>
                                            <span flex="10" layout="row" layout-align="end">
                                                <md-button class="md-icon-button"
                                                    ng-click="guildOverviewCtrl.assignMemberToObjective(guild, objective)">
                                                    <md-icon md-svg-icon="add_person_dark">
                                                    </md-icon>
                                                    <md-tooltip md-direction="bottom" md-delay="1000">
                                                        Assign person
                                                    </md-tooltip>
                                                </md-button>
                                                <md-button class="md-icon-button"
                                                    ng-click="guildOverviewCtrl.removeObjective(guild, objective)">
                                                    <md-icon md-svg-icon="delete_dark">
                                                    </md-icon>
                                                    <md-tooltip md-direction="bottom" md-delay="1000">
                                                        Remove task
                                                    </md-tooltip>
                                                </md-button>
                                            </span>
                                        </md-list-item>
                                        <md-divider ng-if="!$last"></md-divider>
                                    </div>
                                    <md-list-item></md-list-item>
                                </md-list>
                            </md-content>
                        </div>
                    </md-content>
                </section>
            </section>
        </section>

    </section>

</section>
