<cmd-loading-page ng-if="guildRulesCtrl.loading_page"></cmd-loading-page>

<section layout flex ng-if="!guildRulesCtrl.loading_page">
  <section layout layout-wrap layout-fill>
    <cmd-empty-state ng-if="guildRulesCtrl.guilds.length < 1"
      icon="guild_dark"
      headline="Geen team gevonden"
      title="Wacht tot een docent je aan een team toevoegd">
    </cmd-empty-state>
    <section flex layout="column" layout-fill ng-repeat="guild in guildRulesCtrl.guilds" ng-if="guild.id === guildRulesCtrl.selected_guild">
      <cmd-empty-state ng-if="guild.trello_not_configured"
        icon="settings_dark"
        headline="Trello niet ingesteld"
        title="Wacht totdat een docent trello instelt voor dit team">
      </cmd-empty-state>
      <div layout-fill flex ng-if="!guild.trello_not_configured">
        <div layout-fill layout layout-wrap ng-if="guild.rules.length < 8">
          <md-content flex=80 layout-fill layout-padding md-whiteframe=1 id="main__content">
            <section>
              <md-card>
                <md-card-title>
                  <md-card-title-text>
                    <span class="md-headline">Samenwerkingscontract</span>
                  </md-card-title-text>
                  <md-card-title-media>
                </md-card-title>
                <md-card-content>
                  <p>
                    Om de samenwerking zo eerlijk mogenlijk te laten verlopen
                    vragen wij elke project team afspraken op te stellen.
                    Hieronder zie je een lijst met afspraken waarvan wij denken
                    waaraan gehouden zou kunnen worden. Deze afspraken zijn
                    onderverdeeld in vier categorieën:
                  </p>
                  <p layout layout-align="space-around" layout-padding>
                    <span layout="column" layout-align="center center">
                      <md-icon class="icon__size--36" md-svg-icon="work_dark"></md-icon>
                      Houding
                    </span>
                    <span layout="column" layout-align="center center">
                      <md-icon class="icon__size--36" md-svg-icon="group_work_dark"></md-icon>
                      Functioneren binnen het team
                    </span>
                    <span layout="column" layout-align="center center">
                      <md-icon class="icon__size--36" md-svg-icon="lightbulb_dark"></md-icon>
                      Kennisontwikkeling
                    </span>
                    <span layout="column" layout-align="center center">
                      <md-icon class="icon__size--36" md-svg-icon="description_dark"></md-icon>
                      Verantwoording
                    </span>
                  </p>
                  <p>
                    Kies tenminste acht afspraken met uit elke categorie
                    tenminste één afspraak. Ook kun je als team één eigen
                    afspraak opstellen.
                  </p>
                    <em class="text--color--red">Let op:</em> elke week zal iedereen elkaar beoordelen op de gemaakte afspraken.
                  </p>
                </md-card-content>
              </md-card>
              <md-card>
                <md-toolbar>
                  <div class="md-toolbar-tools">
                    Afspraken
                  </div>
                </md-toolbar>
                <md-list ng-if="guild.own_rule">
                  <md-subheader>
                    Eigen afspraak
                  </md-subheader>
                  <md-list-item layout>
                    <span flex>
                      De student {{ guild.own_rule.rule }}
                    </span>
                    <md-icon md-svg-src="delete_dark" class="icon__color--red" ng-click="guildRulesCtrl.toggleRule(guild.own_rule,guild);">
                      <md-tooltip md-direction="left">
                        Verwijder afspraak
                      </md-tooltip>
                    </md-icon>
                  </md-list-item>
                </md-list>
                <md-list ng-repeat="rules in guild.possible_rules">
                  <md-subheader class="md-no-sticky">
                    <span ng-if="rules[0].rule_type === 1">
                      Houding
                    </span>
                    <span ng-if="rules[0].rule_type === 2">
                      Functioneren binnen het team
                    </span>
                    <span ng-if="rules[0].rule_type === 3">
                      Kennisontwikkeling
                    </span>
                    <span ng-if="rules[0].rule_type === 4">
                      Verantwoording
                    </span>
                  </md-subheader>
                  <md-list-item ng-repeat="rule in rules">
                    <md-checkbox ng-change="guildRulesCtrl.toggleRule(rule, guild)"
                    ng-model="rule.selected"
                    aria-label="Select rule">
                    </md-checkbox>
                    De student {{ rule.rule }}
                  </md-list-item>
                </md-list>
              </md-card>
            </section>
          </md-content>
          <section layout="column" layout-align="space-between" layout-padding id="sidebar__content" flex=20>
            <section>
                <span class="md-headline text--color--grey">
                    Checklist
                </span>
                <md-list>
                    <md-list-item layout style="padding: 0;">
                      <span flex>
                        Houding ({{guild.requirements.attitude.selected}})
                      </span>
                      <md-icon ng-if="!guild.requirements.attitude.check" md-svg-src="close_dark" class="icon__color--red"></md-icon>
                      <md-icon ng-if="guild.requirements.attitude.check" md-svg-src="done_dark" class="icon__color--green"></md-icon>
                    </md-list-item>
                    <md-list-item layout style="padding: 0;">
                      <span flex>
                        Functioneren binnen het team ({{guild.requirements.functioning.selected}})
                      </span>
                      <md-icon ng-if="!guild.requirements.functioning.check" md-svg-src="close_dark" class="icon__color--red"></md-icon>
                      <md-icon ng-if="guild.requirements.functioning.check" md-svg-src="done_dark" class="icon__color--green"></md-icon>
                    </md-list-item>
                    <md-list-item layout style="padding: 0;">
                      <span flex>
                        Kennisontwikkeling ({{guild.requirements.knowledge.selected}})
                      </span>
                      <md-icon ng-if="!guild.requirements.knowledge.check" md-svg-src="close_dark" class="icon__color--red"></md-icon>
                      <md-icon ng-if="guild.requirements.knowledge.check" md-svg-src="done_dark" class="icon__color--green"></md-icon>
                    </md-list-item>
                    <md-list-item layout style="padding: 0;">
                      <span flex>
                        Verantwoording ({{guild.requirements.justification.selected}})
                      </span>
                      <md-icon ng-if="!guild.requirements.justification.check" md-svg-src="close_dark" class="icon__color--red"></md-icon>
                      <md-icon ng-if="guild.requirements.justification.check" md-svg-src="done_dark" class="icon__color--green"></md-icon>
                    </md-list-item>
                </md-list>
                <h2 class="md-title text--color--grey">
                    Opstellen
                </h2>
                <section>
                  <div ng-if="guild.selected_rules.length < 8">
                      <md-progress-linear flex md-mode="determinate" value="{{ guild.selected_rules.length * 100 / 8 }}">
                      </md-progress-linear>
                      <div class="text--color--grey">
                        Kies nog minimaal {{ 8 - guild.selected_rules.length | positiveInteger }}
                        <span ng-if="8 - guild.selected_rules.length === 1">afspraak</span>
                        <span ng-if="8 - guild.selected_rules.length != 1">afspraken</span>
                      </div>
                  </div>
                  <div ng-if="guild.selected_rules.length >= 8">
                    <div ng-if="!guild.requirements.attitude.check || !guild.requirements.functioning.check || !guild.requirements.knowledge.check || !guild.requirements.justification.check" layout layout-align="center">
                        <span class="text--color--grey">
                          Kies uit elke categorie tenminste één afspraak
                        </span>
                    </div>
                    <div ng-if="guild.requirements.attitude.check && guild.requirements.functioning.check && guild.requirements.knowledge.check && guild.requirements.justification.check" layout layout-align="center">
                        <md-button class="success md-raised" ng-click="guildRulesCtrl.addRulesToGuild($event, guild)">
                          Bekijk samenwerkingscontract
                        </md-button>
                    </div>
                  </div>
                </section>
            </section>
            <section>
                <md-button ng-disabled="guild.own_rule" class="md-raised success md-block" layout-fill layout ng-click="guildRulesCtrl.addRule($event, guild)">
                    <md-icon md-svg-src="rules_light" ng-class="{'icon__color--grey' : guild.own_rule}"></md-icon>
                    <span flex>
                      Afspraak toevoegen
                    </span>
                </md-button>
                <md-tooltip md-direction="top" ng-if="guild.own_rule">
                  Max één eigen regel per team
                </md-tooltip>
            </section>
          </section>
        </div>
        <div layout-fill layout layout-wrap ng-if="guild.rules.length >= 8">
          <md-content flex=80 layout-fill layout-padding md-whiteframe=1 id="main__content">
            <section>
              <md-card flex>
                <md-toolbar>
                  <div class="md-toolbar-tools" layout layout-align="space-between center">
                    <strong>
                      {{ guild.selected_week.name }}
                    </strong>
                    <span class="md-subhead">
                      Deadline {{ guild.selected_week.end | momentDate : 'DD/MM/YYYY HH:mm' }}
                      <!-- {{ guild.selected_week.start | momentDate : 'DD/MM/YYYY' }}
                      -
                      {{ guild.selected_week.end | momentDate : 'DD/MM/YYYY' }} -->
                    </span>
                  </div>
                </md-toolbar>
                <md-list ng-repeat="week in guild.weeks" ng-if="week.index == guild.selected_week.index">
                  <md-list-item ng-repeat="rule in guild.rules" flex>
                    <section flex layout="column" layout-padding>
                      <div class="md-title" layout-padding>
                        De student {{ rule.rule }}
                      </div>
                      <section flex layout layout-wrap>
                        <section flex=100 flex-gt-sm=50 flex-gt-md=33 flex-gt-lg=25 ng-repeat="member in guild.members" ng-if="member.user.id !== guildRulesCtrl.user.id">
                          <md-card layout="column" layout-align="center center"
                          ng-init="rating = guildRulesCtrl.checkRuleEndorsementStatus(week.index, rule, member.user); new_rating = rating;">
                            <md-card-header>
                              <md-card-avatar>
                                <img ng-if="member.user.avatar_hash" class="round" ng-src="https://trello-avatars.s3.amazonaws.com/{{member.user.avatar_hash}}/30.png">
                                <img ng-if="!member.user.avatar_hash" class="round" gravatar-size="30" gravatar-src="member.user.email">
                              </md-card-avatar>
                              <md-card-header-text>
                                <span class="md-title">
                                  {{ member.user | fullUserName }}
                                </span>
                              </md-card-header-text>
                            </md-card-header>
                            <md-card-content>
                              <section layout class="rating" ng-if="week.editable">
                                <div ng-click="rating = (rating === 1 ? 0 : 1); guildRulesCtrl.setRating(week.index, rule, member.user, (rating === 1 ? 1 : 0), $event)"
                                ng-mouseover="new_rating = (rating === 1 ? 0 : 1)" ng-mouseleave="new_rating = rating">
                                    <md-icon md-svg-src="star_dark" class="icon__size--36 icon__color--lightGreen" ng-if="new_rating >= 1"></md-icon>
                                    <md-icon md-svg-src="star_border_dark" class="icon__size--36" ng-if="new_rating < 1"></md-icon>
                                </div>
                                <div ng-click="rating = 2; guildRulesCtrl.setRating(week.index, rule, member.user, 2, $event)"
                                ng-mouseover="new_rating = 2" ng-mouseleave="new_rating = rating">
                                  <md-icon md-svg-src="star_dark" class="icon__size--36 icon__color--lightGreen" ng-if="new_rating >= 2"></md-icon>
                                  <md-icon md-svg-src="star_border_dark" class="icon__size--36" ng-if="new_rating < 2"></md-icon>
                                </div>
                                <div ng-click="rating = 3; guildRulesCtrl.setRating(week.index, rule, member.user, 3, $event)"
                                ng-mouseover="new_rating = 3" ng-mouseleave="new_rating = rating">
                                  <md-icon md-svg-src="star_dark" class="icon__size--36 icon__color--lightGreen" ng-if="new_rating >= 3"></md-icon>
                                  <md-icon md-svg-src="star_border_dark" class="icon__size--36" ng-if="new_rating < 3"></md-icon>
                                </div>
                                <div ng-click="rating = 4; guildRulesCtrl.setRating(week.index, rule, member.user, 4, $event)"
                                ng-mouseover="new_rating = 4" ng-mouseleave="new_rating = rating">
                                  <md-icon md-svg-src="star_dark" class="icon__size--36 icon__color--lightGreen" ng-if="new_rating >= 4"></md-icon>
                                  <md-icon md-svg-src="star_border_dark" class="icon__size--36" ng-if="new_rating < 4"></md-icon>
                                </div>
                              </section>
                              <section ng-if="!week.editable" layout>
                                <div ng-repeat="star in [1,2,3,4]">
                                  <md-icon md-svg-src="star_dark" class="icon__size--36" ng-class="{
                                    'icon__color--grey': rating < star,
                                    'icon__color--lightGreen': rating >= star
                                  }"></md-icon>
                                </div>
                                <md-tooltip>
                                  Je kunt deze week niet meer bewerken
                                </md-tooltip>
                              </section>
                            </md-card-content>
                          </md-card>
                        </section>
                      </section>
                    </section>
                    <md-divider ng-if="!$last"></md-divider>
                  </md-list-item>
                </md-list>
              </md-card>
            </section>
          </md-content>
          <section layout="column" layout-align="space-between" layout-padding id="sidebar__content" flex=20>
            <section>
              <span class="md-headline text--color--grey">
                Weken
              </span>
              <md-list>
                <md-list-item ng-repeat="week in guild.weeks" flex
                  ng-click="guild.selected_week = week"
                  ng-if="!week.future_week"
                  ng-class="{
                    'active_menu_item': week.index === guild.selected_week.index,
                    'text--color--grey': !week.editable
                  }">
                  <div flex layout layout-align="space-between center">
                    <strong>
                      {{ week.name }}
                    </strong>
                    <span hide-xs hide-sm hide-md hide-lg>
                      {{ week.start | momentDate : 'DD/MM/YYYY' }} - {{ week.end | momentDate : 'DD/MM/YYYY' }}
                    </span>
                  </div>
                </md-list-item>
              </md-list>
            </section>
          </section>
        </div>
      </div>
    </section>
  </section>
</section>
