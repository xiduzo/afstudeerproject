<cmd-loading-page ng-if="guildRulesCtrl.loading_page"></cmd-loading-page>

<section ng-if="!guildRulesCtrl.loading_page" layout-fill>
    <section layout-fill
        ng-repeat="guild in guildRulesCtrl.guilds"
        ng-if="guild.id === guildRulesCtrl.selected_guild">

        <section layout="column" layout-fill>
            <section layout flex layout-fill ng-if="guild.rules.length < 8">
                <md-button class="md-fab icon__fab"
                    ng-click="guildRulesCtrl.addRule($event, guild)">
                    <md-icon md-svg-icon="add_light"></md-icon>
                    <md-tooltip md-direction="left">
                        Add rule
                    </md-tooltip>
                </md-button>
                <section layout layout-align="start stretch"
                    flex=40 layout-margin>
                    <md-content md-whiteframe=1>
                        <md-toolbar>
                            <span class="md-toolbar-tools">
                                Samenwerkingscontract
                            </span>
                        </md-toolbar>
                        <article layout-padding>
                            <p>
                                Om de samenwerking zo eerlijk mogenlijk te laten verlopen
                                vragen wij elke project team afspraken op te stellen.
                                Hiernaast zie je een lijst met afspraken waarvan wij denken
                                waaraan gehouden zou kunnen worden. Deze afspraken zijn
                                onderverdeeld in vier categorieën:
                            </p>

                            <p layout-margin layout layout-align="space-around">
                                <span layout="column" layout-align="center center">
                                    <md-icon class="icon--size--36" md-svg-icon="work_dark"></md-icon>
                                    Houding
                                </span>
                                <span layout="column" layout-align="center center">
                                    <md-icon class="icon--size--36" md-svg-icon="group_work_dark"></md-icon>
                                    Functioneren binnen het team
                                </span>
                                <span layout="column" layout-align="center center">
                                    <md-icon class="icon--size--36" md-svg-icon="lightbulb_dark"></md-icon>
                                    Kennisontwikkeling
                                </span>
                                <span layout="column" layout-align="center center">
                                    <md-icon class="icon--size--36" md-svg-icon="description_dark"></md-icon>
                                    Verantwoording
                                </span>
                            </p>
                            <p>
                                Kies tenminste acht afspraken met uit elke categorie
                                tenminste één afspraak. Ook kun je als team eigen
                                afspraken opstellen.
                            </p>
                                <em>Let op:</em> elke week zal iedereen elkaar
                                beoordelen op de gemaakte afspraken.
                            </p>
                        </article>

                        <section layout="column" layout-margin layout-align="space-around">
                            <h2 class="md-title">
                                Checklist
                            </h2>
                            <span>
                                <md-checkbox ng-disabled="true" ng-model="guild.requirements.attitude.check">
                                    <strong ng-class="{
                                        'text--color--red': !guild.requirements.attitude.check,
                                        'text--color--green': guild.requirements.attitude.check,
                                    }">
                                        Houding ({{guild.requirements.attitude.selected}})
                                    </strong>
                                </md-checkbox>
                            </span>
                            <span>
                                <md-checkbox ng-disabled="true" ng-model="guild.requirements.functioning.check">
                                    <strong ng-class="{
                                        'text--color--red': !guild.requirements.functioning.check,
                                        'text--color--green': guild.requirements.functioning.check,
                                    }">
                                        Functioneren binnen het team ({{guild.requirements.functioning.selected}})
                                    </strong>
                                </md-checkbox>
                            </span>
                            <span>
                                <md-checkbox ng-disabled="true" ng-model="guild.requirements.knowledge.check">
                                    <strong ng-class="{
                                        'text--color--red': !guild.requirements.knowledge.check,
                                        'text--color--green': guild.requirements.knowledge.check,
                                    }">
                                        Kennisontwikkeling ({{guild.requirements.knowledge.selected}})
                                    </strong>
                                </md-checkbox>
                            </span>
                            <span>
                                <md-checkbox ng-disabled="true" ng-model="guild.requirements.justification.check">
                                    <strong ng-class="{
                                        'text--color--red': !guild.requirements.justification.check,
                                        'text--color--green': guild.requirements.justification.check,
                                    }">
                                        Verantwoording ({{guild.requirements.justification.selected}})
                                    </strong>
                                </md-checkbox>
                            </span>
                            <span ng-if="guild.selected_rules.length >= 8">
                                <md-checkbox ng-disabled="true" ng-model="self.fakektrue" ng-init="self.fakektrue = true">
                                    <strong class="text--color--green">
                                        {{ guild.selected_rules.length }} gekozen afspraken
                                    </strong>
                                </md-checkbox>
                            </span>
                            <span ng-if="guild.selected_rules.length < 8">
                                Kies nog minimaal {{ 8 - guild.selected_rules.length | positiveInteger }} afspraken
                                <br />
                                <br />
                                <md-progress-linear flex md-mode="determinate"
                                ng-class="{
                                    'md-warn': guild.selected_rules.length <= 2,
                                    'md-accent': guild.selected_rules.length > 2 &&
                                    guild.selected_rules.length <= 5,
                                }"
                                value="{{ guild.selected_rules.length * 100 / 8 }}">
                                </md-progress-linear>
                            </span>
                            <div ng-if="guild.requirements.attitude.check &&
                                guild.requirements.functioning.check &&
                                guild.requirements.knowledge.check &&
                                guild.requirements.justification.check &&
                                guild.selected_rules.length >= 8"
                                layout layout-align="center">
                                <md-button class="success md-raised"
                                ng-click="guildRulesCtrl.addRulesToGuild($event, guild)">
                                    Bekijk samenwerkingscontract
                                </md-button>
                            </div>
                        </section>
                    </md-content>
                </section>

                <md-content ng-scrollbars flex flex=60>
                    <md-list>
                        <md-list-item ng-repeat="rule in guild.possible_rules">
                            <md-checkbox ng-change="guildRulesCtrl.toggleRule(rule, guild)"
                            ng-model="rule.selected"
                            aria-label="Select rule">
                            </md-checkbox>
                            <md-icon class="icon__helper"
                                md-svg-icon="work_dark"
                                ng-if="rule.rule_type === 1">
                            </md-icon>
                            <md-icon class="icon__helper"
                                md-svg-icon="group_work_dark"
                                ng-if="rule.rule_type === 2">
                            </md-icon>
                            <md-icon class="icon__helper"
                                md-svg-icon="lightbulb_dark"
                                ng-if="rule.rule_type === 3">
                            </md-icon>
                            <md-icon class="icon__helper"
                                md-svg-icon="description_dark"
                                ng-if="rule.rule_type === 4">
                            </md-icon>
                            The student {{ rule.rule  }}
                        </md-list-item>
                    </md-list>
                </md-content>

            </section>

            <section layout flex layout-fill ng-if="guild.rules.length >= 8">
                <section flex=80 layout-margin>
                    <section md-whiteframe=1>
                        <md-toolbar layout-padding>
                            <span layout class="md-toolbar-tools">
                                <span flex=30>
                                    <strong>
                                        Week {{ guild.selected_week + 1}}:
                                    </strong>
                                    {{ guild.weeks[guild.selected_week].start._d | date }}
                                    -
                                    {{ guild.weeks[guild.selected_week].end._d | date }}
                                    <!-- Placeholder -->
                                </span>
                                <span flex=70 layout layout-align="end">
                                    <div layout="column" layout-align="center center"
                                    flex=25
                                    ng-repeat="user in guild.members"
                                    ng-if="user.id !== guildRulesCtrl.user.id">
                                        <img class="round" gravatar-size=45 gravatar-src-once="user.email">
                                        {{ user | fullUserName}}
                                    </div>
                                </span>
                            </span>
                        </md-toolbar>
                        <md-content ng-repeat="week in guild.weeks"
                        ng-if="week.week === guild.selected_week">
                            <md-list>
                                <md-list-item layout ng-repeat="rule in guild.rules">
                                    <span flex=30>
                                        {{ rule.rule }}
                                    </span>
                                    <span flex=70 layout layout-align="end">
                                        <div layout="column" layout-align="center center"
                                        flex=25
                                        ng-repeat="user in guild.members"
                                        ng-if="user.id !== guildRulesCtrl.user.id">
                                            <md-checkbox
                                            style="margin-bottom: 0;"
                                            ng-disabled="!week.editable"
                                            ng-if="user.id !== guildRulesCtrl.user.id"
                                            ng-model="$index"
                                            ng-init="$index = guildRulesCtrl.checkRuleEndorsementStatus(guild, week.week, rule, user)"
                                            ng-change="guildRulesCtrl.toggleRuleEndorsement(guild, week.week, rule, user, $index)"
                                            aria-label="checkbox">
                                             </md-checkbox>
                                        </div>
                                    </span>
                                    <md-divider></md-divider>
                                </md-list-item>
                            </md-list>
                        </md-content>
                    </section>
                </section>
                <md-content flex=20 layout-fill>
                    <md-subheader>
                        Weeks
                    </md-subheader>
                    <section>
                        <md-list>
                            <md-list-item ng-repeat="week in guild.weeks"
                            layout layout-align="space-between"
                            ng-click="guild.selected_week = week.week"
                            ng-class="{
                                'active_menu_item': week.week === guild.selected_week
                            }">
                                <strong layout-padding>
                                    Week {{ week.week + 1 }}:
                                </strong>
                                <span flex>
                                    {{ week.start._d | date }} - {{ week.end._d | date }}
                                </span>
                                <md-icon ng-if="week.week === guild.editable_week"
                                md-svg-src="pencil_dark"
                                class="icon--color--grey">
                                </md-icon>
                            </md-list-item>
                        </md-list>
                    </section>
                </md-content>
            </section>
        </section>
    </section>
</section>
