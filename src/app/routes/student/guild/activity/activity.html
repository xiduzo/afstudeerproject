<section flex layout-fill>

    <cmd-loading-page ng-if="guildActivityCtrl.loading_page"></cmd-loading-page>

    <!-- <cmd-empty-state ng-if="guildActivityCtrl.guilds.length < 1 && !guildActivityCtrl.loading_page"
    icon="guild_dark"
    headline="No group found."
    title="Wait for a lecturer to add you to a class.">
    </cmd-empty-state> -->
    <section ng-if="true" layout-fill>
        <section layout-fill
            ng-repeat="guild in guildActivityCtrl.guilds"
            ng-if="guild.id === guildActivityCtrl.selected_guild">

            <section layout="column" layout-fill>
                <section layout flex layout-align="start stretch">
                    <section layout-fill layout>
                        <cmd-empty-state flex=80 ng-if="guild.no_trello_board"
                            icon="settings_dark"
                            headline="No trello board set."
                            title="Make sure your lecturer set your trello board in the group settings.">
                        </cmd-empty-state>
                        <section ng-scrollbars flex=80 ng-if="!guild.no_trello_board">
                            <md-list class="timeline">
                                <div ng-if="filtered.length <= 0"
                                class="timeline__container" layout layout-align="start start">
                                    <md-button class="timeline__icon md-fab md-accent" md-no-ink
                                    aria-label="timeline icon">
                                        <md-icon md-svg-icon="cmd_book">
                                        </md-icon>
                                    </md-button>
                                    <md-list-item class="timeline__item">
                                        <md-content class="timeline__content" md-whiteframe=1 layout="column" flex>
                                            <section layout layout-align="space-between center">
                                                No activities found.
                                            </section>
                                        </md-content>
                                    </md-list-item>
                                </div>

                                <a class="timeline__container"
                                ng-repeat="activity in filtered = (guild.board.activities
                                | filter : {
                                    type: filters.action_type,
                                } : true
                                | filter: {
                                    creator_id: filters.user
                                }
                                | filter: {
                                    sentence: filters.free_search
                                })" href="{{activity.link}}" target="_BLANK"
                                layout layout-align="start start">
                                    <md-button class="timeline__icon md-fab md-accent" md-no-ink
                                    aria-label="timeline icon">
                                        <md-icon ng-repeat="action_type in guildActivityCtrl.action_types"
                                            md-svg-icon="{{action_type.icon}}"
                                            ng-if="activity.type == action_type.type">
                                        </md-icon>
                                    </md-button>
                                    <md-list-item class="timeline__item">
                                        <md-content class="timeline__content" md-whiteframe=1 layout="column" flex>
                                            <section layout="column" layout-align="start space-between">
                                                <div layout layout-padding>
                                                    <span>
                                                        <img ng-if="activity.memberCreator.avatar" class="round" gravatar-size=25 gravatar-src-once="activity.memberCreator.avatar">
                                                        <span layout layout-align="center center"
                                                        ng-if="!activity.memberCreator.avatar" class="initials icon__helper">
                                                            {{ activity.memberCreator.initials }}
                                                        </span>
                                                    </span>
                                                    <span ng-bind-html="activity.sentence | empasizeSubject : activity.subject">
                                                    </span>
                                                </div>
                                                <div class="text--color--grey"
                                                layout layout-align="end">
                                                    <span>
                                                        <md-icon class="icon--color--grey" md-svg-icon="clock_dark"></md-icon>
                                                        {{ activity.date | fromNow }}
                                                    </span>
                                                </div>
                                            </section>
                                            <!-- {{ activity }} -->
                                        </md-content>
                                    </md-list-item>
                                </a>
                            </md-list>
                        </section>

                        <md-content flex=20>
                            <md-subheader>
                                Filter activities
                            </md-subheader>
                            <section layout-padding>
                                <md-input-container class="md-block">
                                    <label>Type</label>
                                    <md-select ng-model="filters.action_type">
                                        <md-option ng-value="undefined"> All </md-option>
                                        <md-option ng-repeat="action_type in guildActivityCtrl.action_types"
                                            ng-value="action_type.type" layout>
                                            <md-icon class="icon__helper icon--color--black"
                                            md-svg-icon="{{action_type.icon}}">
                                            </md-icon>
                                            {{action_type.name}}
                                        </md-option>
                                    </md-select>
                                </md-input-container>
                            </section>
                            <section layout-padding>
                                <md-input-container class="md-block">
                                    <label>User</label>
                                    <md-select ng-model="filters.user">
                                        <md-option ng-value="undefined"> All </md-option>
                                        <md-option ng-repeat="user in guild.board.members"
                                            ng-value="user.id" layout>
                                            <div layout layout-align="start center">
                                                <img ng-if="user.avatar" class="icon__helper round" gravatar-size=25 gravatar-src-once="user.avatar">
                                                <span layout layout-align="center center"
                                                ng-if="!user.avatar" class="initials icon__helper">
                                                    {{ user.initials }}
                                                </span>
                                                <span flex>
                                                    {{ user.name }}
                                                </span>
                                            </div>
                                        </md-option>
                                    </md-select>
                                </md-input-container>
                            </section>
                            <section layout-padding>
                                <md-input-container class="md-block">
                                    <label>Subject</label>
                                    <input ng-model="filters.free_search"
                                    ng-model-options=" { debounce: 500 }">
                                    <div class="hint text--color--grey">
                                        The subject has a black background
                                    </div>
                                </md-input-container>
                            </section>
                        </md-content>
                    </section>
                </section>
            </section>

        </section>
    </section>


</section>
