<section flex layout-fill>

    <cmd-loading-page ng-if="guildActivityCtrl.loading_page"></cmd-loading-page>

    <!-- <cmd-empty-state ng-if="guildActivityCtrl.guilds.length < 1 && !guildActivityCtrl.loading_page"
    icon="guild_dark"
    headline="No group found."
    title="Wait for a lecturer to add you to a class.">
    </cmd-empty-state> -->
    <section ng-if="true" layout-fill>
        <section layout-fill
            ng-repeat="guild in guildActivityCtrl.guilds"
            ng-if="guild.id === guildActivityCtrl.selected_guild">

            <section layout="column" layout-fill>
                <md-toolbar>
                    <span class="md-toolbar-tools">
                        {{ guild.name }}
                    </span>
                </md-toolbar>

                <section layout flex layout-align="start stretch">
                    <section layout-fill layout>
                        <section ng-scrollbars flex=80>
                            <md-list class="timeline">
                                <div class="timeline__container"
                                ng-repeat="activity in guild.history_updates
                                | filter : {
                                    action_type: (filters.action_type | parseInt ),

                                } : true
                                | filter: {
                                    user_id: filters.user
                                }
                                | filter: {
                                    action: filters.free_search
                                }"
                                layout layout-align="start start">
                                    <md-button class="timeline__icon md-fab md-accent" md-no-ink
                                    aria-label="timeline icon">
                                        <!-- (1, 'added task'), -->
                                        <md-icon md-svg-icon="add_light"
                                        ng-if="activity.action_type === 1">
                                        </md-icon>
                                        <!-- (2, 'removed task'), -->
                                        <md-icon md-svg-icon="delete_light"
                                        ng-if="activity.action_type === 2">
                                        </md-icon>
                                        <!-- (3, 'assigned'), -->
                                        <md-icon md-svg-icon="add_person_light"
                                        ng-if="activity.action_type === 3">
                                        </md-icon>
                                        <!-- (4, 'remove assigned'), -->
                                        <md-icon md-svg-icon="person_outline_light"
                                        ng-if="activity.action_type === 4">
                                        </md-icon>
                                        <!-- (5, 'completed'), -->
                                        <md-icon md-svg-icon="done_light"
                                        ng-if="activity.action_type === 5">
                                        </md-icon>
                                        <!-- (6, 'remove completed'), -->
                                        <md-icon md-svg-icon="close_light"
                                        ng-if="activity.action_type === 6">
                                        </md-icon>
                                        <!-- (7, 'graded'), -->
                                        <md-icon md-svg-icon="pencil_light"
                                        ng-if="activity.action_type === 7">
                                        </md-icon>
                                        <!-- (8, 'regraded'), -->
                                        <md-icon md-svg-icon="again_light"
                                        ng-if="activity.action_type === 8">
                                        </md-icon>
                                        <!-- (9, 'completed assessment'), -->
                                        <md-icon md-svg-icon="done_light"
                                        ng-if="activity.action_type === 9">
                                        </md-icon>
                                        <!-- (10, 'remove completed assessment'), -->
                                        <md-icon md-svg-icon="close_light"
                                        ng-if="activity.action_type === 10">
                                        </md-icon>
                                    </md-button>
                                    <md-list-item class="timeline__item">
                                        <md-content class="timeline__content" md-whiteframe=1 layout="column" flex>
                                            <section layout layout-align="space-between center">
                                                <div>
                                                    <span layout-margin>
                                                        <img class="round" gravatar-size=32 gravatar-src-once="activity.user.email">
                                                    </span>
                                                    {{ activity.user | fullUserName }}
                                                    <span ng-bind-html="activity.action"></span>
                                                </div>
                                                <div class="text--color--grey">
                                                    <md-icon class="icon--color--grey" md-svg-icon="clock_dark"></md-icon>
                                                    {{ activity.created_at | fromNow }}
                                                </div>
                                            </section>
                                            <!-- {{ activity }} -->
                                        </md-content>
                                    </md-list-item>
                                </div>
                            </md-list>
                            <section layout layout-align="center center" layout-margin>
                                <md-button class="md-raised success"
                                    ng-if="!guildActivityCtrl.nothing_more_to_load"
                                    ng-click="guildActivityCtrl.loadMoreHistoryUpdates(guild)"
                                    ng-disabled="guildActivityCtrl.getting_more_activities"
                                    aria-label="Load more activities">
                                    <span ng-if="!guildActivityCtrl.getting_more_activities">
                                        LOAD MORE
                                    </span>
                                    <span ng-if="guildActivityCtrl.getting_more_activities">
                                        GETTING MORE ACTIVITIES
                                    </span>
                                </md-button>

                            </section>
                        </section>

                        <md-content flex=20>
                            <md-subheader>
                                Filter activities
                            </md-subheader>
                            <section layout-padding>
                                <md-input-container class="md-block">
                                    <label>Type</label>
                                    <md-select ng-model="filters.action_type">
                                        <md-option ng-value="undefined"> All </md-option>
                                        <md-option ng-repeat="action_type in guildActivityCtrl.action_types"
                                            ng-value="action_type.type">
                                            {{action_type.name}}
                                        </md-option>
                                    </md-select>
                                </md-input-container>
                            </section>
                            <section layout-padding>
                                <md-input-container class="md-block">
                                    <label>User</label>
                                    <md-select ng-model="filters.user">
                                        <md-option ng-value="undefined"> All </md-option>
                                        <md-option ng-repeat="user in guild.user_filter_list"
                                            ng-value="user.id">
                                            <img class="round" gravatar-size=25 gravatar-src-once="user.email">
                                            {{user.name}}
                                        </md-option>
                                    </md-select>
                                </md-input-container>
                            </section>
                            <section layout-padding>
                                <md-input-container class="md-block">
                                    <label>Activity</label>
                                    <input ng-model="filters.free_search"
                                    ng-model-options="{ debounce: 500 }">
                                </md-input-container>
                            </section>
                        </md-content>
                    </section>
                </section>
            </section>

        </section>
    </section>


</section>
