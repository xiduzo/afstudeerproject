<cmd-loading-page ng-if="studentDashboardCtrl.loading_page"></cmd-loading-page>

<section ng-if="!studentDashboardCtrl.loading_page" layout-fill>
  <section ng-repeat="guild in studentDashboardCtrl.guilds" ng-if="guild.id === studentDashboardCtrl.selected_guild" layout-fill>
    <md-content id="main__content" layout="column" layout-fill layout-padding ng-scrollbars>
      <section layout layout-wrap>
        <section flex=25 layout>
          <md-card flex layout="column" layout-align="space-between">
                <md-card-content>
                  <section layout="column" layout-align="center center">
                    <h1 class="md-display-2">
                      <md-progress-circular md-diameter="70" md-mode="determinate" value="{{ (guild.current_week.end | hoursToGo) * 100 / (7*24) }}"></md-progress-circular>
                    </h1>
                    <div>
                      nog {{ guild.current_week.end | daysToGo }}
                      dag<span ng-if="(guild.current_week.end | daysToGo) != 1">en</span> om feedback te geven
                    </div>
                  </section>
                </md-card-content>
                <div class="indication__bar" ng-class="{
                  'indication__bar--error' : (guild.current_week.end | hoursToGo) <= (1 * 24),
                  'indication__bar--warning' : (guild.current_week.end | hoursToGo) <= (4 * 24),
                  'indication__bar--success': (guild.current_week.end | hoursToGo) > (4 * 24)
                }"></div>
          </md-card>
        </section>
        <section flex=50 layout>
          <md-card flex layout="column" layout-align="space-between">
              <md-card-content layout flex>
                  <section flex=50 layout layout-align="center center">
                      <div layout="column" layout-align="center center">
                          <h1 class="md-display-2">
                              {{ guild.trello_cards.length }}
                          </h1>
                          <div>
                            onvoltooide kaart<span ng-if="guild.trello_cards.length >= 2 || guild.trello_cards.length === 0">en</span>
                          </div>
                      </div>
                  </section>
                  <section flex=50 layout layout-align="center center">
                      <div layout="column" layout-align="center center">
                          <h1 class="md-display-2">
                              {{ (guild.trello_cards | cardsDueThisWeek : guild.current_week).length }}
                          </h1>
                          <div>
                              kaart<span ng-if="(guild.trello_cards | cardsDueThisWeek : guild.current_week).length >= 2 || (guild.trello_cards | cardsDueThisWeek : guild.current_week).length === 0">en</span> met vervaldatum
                          </div>
                          <md-tooltip>
                            Periode: {{ guild.current_week.start | momentDate : 'DD/MM/YYYY' }} - {{ guild.current_week.end | momentDate : 'DD/MM/YYYY' }}
                          </md-tooltip>
                      </div>
                  </section>
              </md-card-content>
              <div class="indication__bar indication__bar--success" ng-class="{
                'indication__bar--error' : (guild.trello_cards | cardsDueThisWeek : guild.current_week).length * 100 / guild.trello_cards.length >= 60,
                'indication__bar--warning' : (guild.trello_cards | cardsDueThisWeek : guild.current_week).length * 100 / guild.trello_cards.length >= 33
              }"></div>
          </md-card>
        </section>
        <section flex=25 layout>
          <md-card flex layout="column" layout-align="space-between center">
                <md-card-content>
                  <section layout="column" layout-align="center center">
                    <h1 class="md-display-2">
                      <md-progress-circular md-diameter="70" md-mode="determinate" value="{{ (guild.world.end | hoursToGo) * 100 / (guild.world.course_duration * 7 * 24) }}"></md-progress-circular>
                    </h1>
                    <div>
                      {{ guild.world.name }} duurt nog {{ guild.world.end | daysToGo }}
                      dag<span ng-if="(guild.world.end | daysToGo) != 1">en</span>
                    </div>
                  </section>
                </md-card-content>
                <div class="indication__bar indication__bar--success" ng-class="{
                  'indication__bar--error' : (guild.world.end | hoursToGo) * 100 / (guild.world.course_duration * 7 * 24) <= 15,
                  'indication__bar--warning' : (guild.world.end | hoursToGo) * 100 / (guild.world.course_duration * 7 * 24) <= 35
                }"></div>
          </md-card>
        </section>
      </section>
      <section layout style="height: 350px;">
        <md-card flex=60 id="line__{{guild.id}}"></md-card>
        <md-card flex=40 id="polar__{{guild.id}}"></md-card>
      </section>

      <section>
        <h1 class="md-title text--color--grey" style="padding: 0 0 0 8px;">
          Mijn kaarten
        </h1>
        <md-list flex class="timeline">
          <md-list-item layout layout-align="center center" class="text--color--grey" ng-if="guild.trello_cards.length <= 0">
            Al jouw kaarten zijn voltooid
          </md-list-item>
          <md-list-item flex ng-repeat="card in guild.trello_cards | orderBy: ['due', 'created_at']" style="padding: 0;">
            <trello-card card="card"></trello-card>
          </md-list-item>
        </md-list>
      </section>
      <!-- main content -->
    </md-content>
  </section>
</section>
